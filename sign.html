<!DOCTYPE html>
<html>
<head>
  <title>TON Connect Sign Request</title>
  <script type="module">
    import { TonConnect, toUserFriendlyAddress } from "@tonconnect/sdk";

    const urlParams = new URLSearchParams(window.location.search);
    const amount = urlParams.get("amount");
    const to = urlParams.get("to");

    const tonConnect = new TonConnect({
      manifestUrl: "https://gigi-ton-connect-v2-deploy.onrender.com/tonconnect-manifest.json"
    });

    async function connectAndSign() {
      const connected = await tonConnect.restoreConnection();
      if (!connected) {
        await tonConnect.connectWallet();
      }

      const wallet = tonConnect.wallet;
      if (!wallet) {
        document.body.innerHTML = "❌ Wallet not connected.";
        return;
      }

      const tx = {
        validUntil: Math.floor(Date.now() / 1000) + 300,
        messages: [
          {
            address: to,
            amount: amount.toString(),
          },
        ],
      };

      try {
        await tonConnect.sendTransaction(tx);
        document.body.innerHTML = "✅ Transaction Sent!";
      } catch (e) {
        console.error(e);
        document.body.innerHTML = "❌ Transaction Cancelled.";
      }
    }

    connectAndSign();
  </script>
</head>
<body style="background:#000;color:#fff;display:flex;align-items:center;justify-content:center;height:100vh;">
  <h2>TON Connect Sign Request</h2>
</body>
</html>
