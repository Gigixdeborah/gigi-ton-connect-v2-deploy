<script type="module">
  import { TonConnect } from "https://unpkg.com/@tonconnect/sdk@latest";

  const urlParams = new URLSearchParams(window.location.search);
  const to = urlParams.get("to");
  const amount = urlParams.get("amount");

  const statusEl = document.getElementById("status");

  async function run() {
    try {
      const connector = new TonConnect({
        manifestUrl: "https://gigi-ton-connect-v2-deploy.onrender.com/tonconnect-manifest.json"
      });

      await connector.restoreConnection();

      // Force connect if not connected yet
      if (!connector.connected) {
        await connector.connect({ jsBridgeKey: 'ton-injected' }); // üëà Key for Telegram wallet
      }

      if (!connector.connected) {
        statusEl.textContent = "‚ùå Wallet not connected.";
        return;
      }

      // Send transaction
      await connector.sendTransaction({
        validUntil: Math.floor(Date.now() / 1000) + 600,
        messages: [{ address: to, amount: amount }]
      });

      statusEl.textContent = "‚úÖ Transaction sent to TON Wallet!";
    } catch (err) {
      console.error("‚ùå Error:", err);
      statusEl.textContent = "‚ùå Signing cancelled or failed.";
    }
  }

  run();
</script>
